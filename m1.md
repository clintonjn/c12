# React Native Environment Setup Guide

## Overview
This guide explains how to set up multiple environments (dev, staging, preprod, production) in React Native using react-native-dotenv and Expo prebuild.

## Problem Statement
- Need separate configurations for different deployment stages
- Want to install multiple app versions simultaneously on device
- Avoid Metro cache issues when switching environments
- Prevent git conflicts with generated native code

## Solution Architecture
Uses Expo's app config system with environment variables to generate different native projects for each environment, rather than manual Android flavors or iOS schemes that get overwritten by prebuild.

## Environment Configuration

### 1. Environment Files
```
.env.dev              # Development environment
.env.staging          # Staging environment  
.env.preproduction    # Pre-production environment
.env.production       # Production environment
```

Each file contains:
```
IS_PRODUCTION=false
ENVIRONMENT=dev
API_BASE_URL=https://api.dev.c12app.com
APP_NAME="C12 Dev"
```

### 2. Dependencies
```bash
npm install react-native-dotenv @types/react-native-dotenv --save-dev
npm install babel-preset-expo --save-dev
```

### 3. Babel Configuration
`babel.config.js`:
```js
module.exports = function (api) {
  api.cache(true);
  return {
    presets: ['babel-preset-expo'],
    plugins: [
      ['module:react-native-dotenv', {
        envName: 'APP_ENV',
        moduleName: '@env',
        path: '.env',
      }]
    ],
  };
};
```

### 4. App Configuration
`app.config.js` - Generates different app names and package IDs:
```js
const ENV = process.env.ENVIRONMENT;

const getAppName = () => {
  switch (ENV) {
    case 'dev': return 'C12 Dev';
    case 'staging': return 'C12 Staging';
    case 'preproduction': return 'C12 PreProd';
    case 'production': return 'C12';
    default: return 'C12 Dev';
  }
};

const getPackageId = () => {
  switch (ENV) {
    case 'dev': return 'com.c12.dev';
    case 'staging': return 'com.c12.staging';
    case 'preproduction': return 'com.c12.preprod';
    case 'production': return 'com.c12';
    default: return 'com.c12.dev';
  }
};

export default {
  expo: {
    name: getAppName(),
    slug: 'c12',
    version: '1.0.0',
    android: {
      package: getPackageId(),
      adaptiveIcon: {
        backgroundColor: getIconColor(),
      },
    },
    ios: {
      bundleIdentifier: getPackageId(),
    },
  },
};
```

### 5. Build Scripts
`package.json` scripts for each environment:
```json
{
  "scripts": {
    "prebuild:dev": "ENVIRONMENT=dev expo prebuild --clean",
    "prebuild:staging": "ENVIRONMENT=staging expo prebuild --clean",
    "prebuild:preprod": "ENVIRONMENT=preproduction expo prebuild --clean",
    "prebuild:prod": "ENVIRONMENT=production expo prebuild --clean",
    "run:dev": "ENVIRONMENT=dev expo run:android",
    "run:staging": "ENVIRONMENT=staging expo run:android",
    "run:preprod": "ENVIRONMENT=preproduction expo run:android",
    "run:prod": "ENVIRONMENT=production expo run:android"
  }
}
```
## Git Configuration

### .gitignore Setup
```
# Generated native folders (expo prebuild)
android/
ios/
```

**Why exclude native folders:**
- Generated by `expo prebuild` from app config
- Prevents merge conflicts on generated code
- Each developer generates their own native folders
- Ensures consistent builds across team

## Usage Workflow

### Daily Development
```bash
# Setup environment (first time or when switching)
npm run prebuild:dev

# Build and run
npm run run:dev
```

### Environment Switching
```bash
# Switch to staging
npm run prebuild:staging
npm run run:staging

# Switch to production
npm run prebuild:prod  
npm run run:prod
```

### Team Onboarding
```bash
git clone <repo>
npm install
npm run prebuild:dev    # Generates android/ios folders
npm run run:dev
```

## Key Benefits

1. **Simultaneous Installation**: All 4 apps can be installed on same device
2. **Clear Identification**: Different app names and icon colors
3. **No Cache Issues**: `--clean` flag prevents Metro cache problems
4. **Team Consistency**: Generated folders ensure same build for everyone
5. **No Manual Native Config**: Everything through Expo app config

## Environment Results

| Environment | App Name | Package ID | Icon Color |
|-------------|----------|------------|------------|
| Dev | C12 Dev | com.c12.dev | Orange |
| Staging | C12 Staging | com.c12.staging | Teal |
| PreProd | C12 PreProd | com.c12.preprod | Blue |
| Production | C12 | com.c12 | White |

## Troubleshooting

### Metro Cache Issues
If environment variables seem stale:
```bash
npx expo start --clear
```

### Missing babel-preset-expo
```bash
npm install babel-preset-expo --save-dev
```

### App Shows "Expo Go" Name
You're running in development mode. Use `expo run:android` instead of `expo start` to see actual app names.

## Technical Reasoning

**Why Expo app config over manual flavors:**
- Expo prebuild overwrites manual Android/iOS configurations
- App config ensures consistency across prebuilds  
- Environment variables baked in at build time
- Prevents configuration drift between environments

**Why separate package IDs:**
- Allows multiple environment apps on same device
- Clear separation in app stores
- Different signing certificates per environment
- Independent app data and permissions
## Icon Configuration

### Current Setup: Same Icon with Different Backgrounds
The project uses a single icon (`mobile-development.png`) with different background colors for each environment:

- **Dev**: Orange background (#ff6b35)
- **Staging**: Teal background (#4ecdc4)  
- **PreProd**: Purple background (#d145beff)
- **Production**: White background (#ffffff)

### Alternative: Different Icons Per Environment
To use completely different icons for each environment:

1. **Create 4 icon files** (1024x1024 PNG) in `assets/` directory:
   - `icon-dev.png` - Development icon
   - `icon-staging.png` - Staging icon  
   - `icon-preprod.png` - Pre-production icon
   - `icon-prod.png` - Production icon

2. **Update app.config.js**:
   - Uncomment the `getIcon()` function
   - Replace `icon: './assets/mobile-development.png'` with `icon: getIcon()`
   - Replace adaptive icon settings with `icon: getIcon()`

### Icon Creation Options:

**Option 1: Online Icon Generator**
- Use https://icon.kitchen or similar tools
- Create 4 versions with different themes/colors
- Download as 1024x1024 PNG

**Option 2: Design Tools**
- Use Figma, Canva, or Photoshop
- Create base design with environment-specific variations
- Export as PNG 1024x1024

**Option 3: Command Line (ImageMagick)**
```bash
# Create simple colored icons
convert -size 1024x1024 xc:"#ff6b35" assets/icon-dev.png
convert -size 1024x1024 xc:"#4ecdc4" assets/icon-staging.png  
convert -size 1024x1024 xc:"#45b7d1" assets/icon-preprod.png
convert -size 1024x1024 xc:"#ffffff" assets/icon-prod.png
```
